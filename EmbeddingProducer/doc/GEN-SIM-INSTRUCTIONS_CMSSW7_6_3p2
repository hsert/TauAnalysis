######### embedding step ##################################3
cmsDriver.py TauAnalysis/EmbeddingProducer/python/lhehadronizerpythia8tauolafilter_cfi.py  \
  --filein file:skimmed.root --fileout file:step1.root \
  --conditions auto:run2_mc --era Run2_25ns \
  --eventcontent FEVTDEBUG --relval 9000,50 \
  --step GEN,SIM --datatier GEN-SIM \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --beamspot NominalCollision2015 --no_exec -n -1 



cmsDriver.py step2  --conditions auto:run2_mc_25ns14e33_v4 \
  --filein file:step1.root --fileout file:step2.root \
  --step DIGI:pdigi_valid,L1,DIGI2RAW,HLT:@relval25ns \
  --datatier GEN-SIM-DIGI-RAW-HLTDEBUG  \
  --era Run2_25ns --eventcontent FEVTDEBUGHLT \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1


cmsDriver.py step2  --conditions auto:run2_mc_25ns14e33_v4 \
  --filein file:step1.root --fileout file:step2.root \
  --step DIGI,DATAMIX,L1,DIGI2RAW,HLT:@relval25ns \
  --datatier GEN-SIM-DIGI-RAW-HLTDEBUG  \
  --era Run2_25ns --eventcontent FEVTDEBUGHLT \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1




cmsDriver.py step3  --runUnscheduled  --conditions auto:run2_mc_25ns14e33_v4 \
  --filein file:step2.root --fileout file:step3.root \
  --step RAW2DIGI,L1Reco,RECO,EI,PAT,VALIDATION:@standardValidation+@miniAODValidation,DQM:@standardDQM+@miniAODDQM \
  --datatier GEN-SIM-RECO,MINIAODSIM,DQMIO \
  --era Run2_25ns --eventcontent RECOSIM,MINIAODSIM,DQM \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1



cmsDriver.py step3  --runUnscheduled  --conditions 76X_dataRun2_v15 \
  --filein file:step2.root --fileout file:step3.root \
  --step RAW2DIGI,L1Reco,RECO,PAT \
  --datatier GEN-SIM-RECO,MINIAODSIM \
  --era Run2_25ns --eventcontent RECOSIM,MINIAODSIM \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1 --data








_____ Mini AOD and RECO in the same run

cmsDriver.py step3  --runUnscheduled  --conditions 76X_mcRun2_asymptotic_v12 \
  --filein file:step2.root --fileout file:step3.root \
  --step RAW2DIGI,L1Reco,RECO,PAT \
  --datatier GEN-SIM-RECO,MINIAODSIM \
  --era Run2_25ns --eventcontent RECOSIM,MINIAODSIM \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1


____ or RECO and after reco MINIAOD

cmsDriver.py step3 --conditions 76X_mcRun2_asymptotic_v12 \
  --filein file:step2.root --fileout file:step3.root \
  --mc --eventcontent AODSIM --runUnscheduled --datatier AODSIM \
  --step RAW2DIGI,L1Reco,RECO,EI --era Run2_25ns \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec  -n -1


cmsDriver.py step4 --conditions 76X_mcRun2_asymptotic_v12 \
  --filein file:step3.root --fileout file:step4.root \
  --mc --eventcontent MINIAODSIM --runUnscheduled --datatier MINIAODSIM \
  --step PAT --era Run2_25ns \
  --customise TauAnalysis/EmbeddingProducer/customisers.customiseAllSteps \
  --no_exec -n -1







                                           [4]: cmsDriver.py step4  --filetype DQM --conditions auto:run2_mc_25ns14e33_v4 --mc  -s HARVESTING:@standardValidation+@standardDQM+@miniAODValidation+@miniAODDQM --era Run2_25ns -n 100 
                                           [5]: cmsDriver.py step5  --conditions auto:run2_mc_25ns14e33_v4 --filein file:step3.root -s ALCA:TkAlMuonIsolated+TkAlMinBias+MuAlOverlaps --datatier ALCARECO -n 1000 --era Run2_25ns --eventcontent ALCARECO



oooooooooooooooooooooooooooooooooooooooollllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllddddddddddddddddddddddddddddddddddddddddddddd

############# Step0 -> GenFiler #######################################
# Step0 is not realy mentored but nice to have, since it saves a lot of computing resuces (disk space and cpu time) 
# if you want to run over the full mc do for change the filein e.g. to :
# --filein dbs:/DYJetsToLL_M-50_13TeV-madgraph-pythia8-tauola_v2/Fall13-POSTLS162_V1-v2/GEN-SIM
cmsDriver.py TauAnalysis/EmbeddingProducer/python/cmsDriver_fragments/DYToMuMuGenFilter_cff.py \
  --filein /store/mc/Fall13/DYJetsToLL_M-50_13TeV-madgraph-pythia8-tauola_v2/GEN-SIM/POSTLS162_V1-v2/10000/002DE29C-80E3-E311-B666-003048CF66D4.root \
  --fileout file:step0.root \
  --mc --eventcontent RAWSIM \
  --era Run2_25ns --customise Configuration/DataProcessing/Utils.addMonitoring \
  --conditions 74X_mcRun2_asymptotic_AllChannelsGood_v0 --step GEN:genmuonFilterSequence\
  --magField 38T_PostLS1 --python_filename step0_cfg.py --no_exec -n 300


############### Step 1 -> SIM and Pile Up mixing state #############
# you can change the pileup scenario. The actual input was generated by the following input (But save time to not make a dbs querry)  
# --pileup_input "dbs:/MinBias_TuneCUETP8M1_13TeV-pythia8/RunIIWinter15GS-MCRUN2_71_V1-v1/GEN-SIM" \
cmsDriver.py step1 --filein file:step0.root \
 --fileout file:step1.root \
 --pileup_input "/store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/0028ABCB-74B0-E411-B596-0025904C4F50.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/007FD3D8-74B0-E411-AC02-782BCB67826E.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/00AAE11D-74B0-E411-BCF8-DF448471F33D.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/00BC66B7-6CAF-E411-86B6-20CF3056171F.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/00C59C87-75B0-E411-918F-63BFB108B170.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/02052468-72AF-E411-9F90-002590D9D990.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/022D9B0E-6EAF-E411-90AA-0022195E66A7.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/027B2D2C-74B0-E411-8DF1-001E682F8C7C.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/02B9B6A5-74B0-E411-A287-002590491B22.root, /store/mc/RunIIWinter15GS/MinBias_TuneCUETP8M1_13TeV-pythia8/GEN-SIM/MCRUN2_71_V1-v1/00000/02C48802-6EAF-E411-96A0-001E67248688.root" \
 --pileup 2015_25ns_Startup_PoissonOOTPU \
 --mc --eventcontent RAWSIM \
 --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
 --datatier GEN-SIM-RAW --conditions 74X_mcRun2_asymptotic_AllChannelsGood_v0 --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns \
 --magField 38T_PostLS1 --python_filename step1_cfg.py --no_exec -n -1 


######### Step2 -> RECO ####################
cmsDriver.py step2 --filein file:step1.root --fileout file:step2.root \
  --mc --eventcontent RECOSIM \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --datatier GEN-SIM-RECO --conditions 74X_mcRun2_asymptotic_AllChannelsGood_v0 --step RAW2DIGI,L1Reco,RECO  \
  --magField 38T_PostLS1 --python_filename step2_cfg.py --no_exec -n -1

######### RECO -> Skimmed ##################
cmsDriver.py standard \
--filein file:step2.root --fileout file:skimmed.root \
--customise TauAnalysis/EmbeddingProducer/EmbeddingCustomisers.skimCustomisation,SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
--conditions 74X_mcRun2_asymptotic_AllChannelsGood_v0 --magField 38T_PostLS1 \
--python_filename skimmed_cfg.py --no_exec -n -1 --step POSTRECO












--mc --eventcontent RAWSIM --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring --datatier GEN-SIM --conditions MCRUN2_71_V1::All --beamspot Realistic50ns13TeVCollision --step GEN,SIM --magField 38T_PostLS1 --python_filename GEN_SIM --no_exec -n -1


 --pileup_input dbs:/MinBias_TuneCUETP8M1_13TeV-pythia8/RunIISummer15GS-MCRUN2_71_V1-v2/GEN-SIM --mc --eventcontent RAWSIM --pileup 2015_25ns_FallMC_matchData_PoissonOOTPU --datatier GEN-SIM-RAW --conditions 76X_mcRun2_asymptotic_v12 --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns --era Run2_25ns --python_filename /afs/cern.ch/cms/PPD/PdmV/work/McM/submit/HIG-RunIIFall15DR76-01131/HIG-RunIIFall15DR76-01131_1_cfg.py --no_exec --customise Configuration/DataProcessing/Utils.addMonitoring -n -1


--mc --eventcontent AODSIM,DQM --runUnscheduled --datatier AODSIM,DQMIO --conditions 76X_mcRun2_asymptotic_v12 --step RAW2DIGI,L1Reco,RECO,EI,DQM:DQMOfflinePOGMC --era Run2_25ns --python_filename /afs/cern.ch/cms/PPD/PdmV/work/McM/submit/HIG-RunIIFall15DR76-01131/HIG-RunIIFall15DR76-01131_2_cfg.py --no_exec --customise Configuration/DataProcessing/Utils.addMonitoring -n -1


--mc --eventcontent MINIAODSIM --runUnscheduled --datatier MINIAODSIM --conditions 76X_mcRun2_asymptotic_v12 --step PAT --era Run2_25ns --python_filename /afs/cern.ch/cms/PPD/PdmV/work/McM/submit/HIG-RunIIFall15MiniAODv2-01000/HIG-RunIIFall15MiniAODv2-01000_1_cfg.py --no_exec --customise Configuration/DataProcessing/Utils.addMonitoring -n -1


######### embedding step ##################################3
cmsDriver.py step1 \
  --beamspot Realistic50ns13TeVCollision  \
  --filein file:step0.root  --fileout file:step1.root --python_filename embedd_step1.py  \
  --mc --eventcontent RAWSIM --datatier GEN-SIM-DIGI-RAW-HLTDEBUG \
  --conditions 76X_mcRun2_asymptotic_v12 --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:@frozen25ns --magField 38T_PostLS1  \
  --customise Configuration/DataProcessing/Utils.addMonitoring  --era Run2_25ns \
  --no_exec -n -1



cmsDriver.py step1 --filein file:skimmed.root --fileout file:embedd.root \
 --mc --eventcontent RAWSIM --beamspot Realistic50ns13TeVCollision   \
 --Configuration/DataProcessing/Utils.addMonitoring --era Run2_25ns \
 --conditions 76X_mcRun2_asymptotic_v12 --beamspot Realistic50ns13TeVCollision \
 --datatier GEN-SIM-RAW --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:@frozen25ns \
 --python_filename embedd_cfg.py --no_exec -n -1 


cmsDriver.py embedd  --filein file:step0.root \
 --conditions auto:run2_mc -n 10 --era Run2_25ns \
 --eventcontent FEVTDEBUG --relval 9000,50 -s GEN,SIM --datatier GEN-SIM --beamspot Realistic50ns13TeVCollision




















######### embedding fastsim ##################################3
cmsDriver.py embedd  --filein file:skimmed.root \
 --conditions auto:run2_mc_25ns14e33_v4 --fast \
 --era Run2_25ns --eventcontent RECOSIM \
 -s GEN,SIM,RECOBEFMIX,L1,L1Reco,RECO,HLT:@relval25ns,VALIDATION \
 --datatier GEN-SIM-DIGI-RECO --beamspot Realistic50ns13TeVCollision \
 --python embbed_fastsim.py --fileout file:embedded.root --no_exec -n -1 








cmsDriver.py TauAnalysis/EmbeddingProducer/python/cmsDriver_fragments/MuonPairSelector_cff.py \
  --filein file:step2.root \
  --fileout file:embed.root \
  --mc --eventcontent RECOSIM  \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --conditions MCRUN2_74_V9A --step GEN:makePatMuons,SIM,DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco,RECO \
  --magField 38T_PostLS1 --python_filename embedd_cfg.py --no_exec -n -1




cmsDriver.py TauAnalysis/MCEmbeddingTools/python/PFEmbeddingSource_cff \
  --filein=file:skimmed.root \
  --fileout=embedded.root --python_filename=embed.py \
  --conditions MCRUN2_74_V9A --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco,RECO,EI --magField 38T_PostLS1 \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring  \
  --customise TauAnalysis/MCEmbeddingTools/setDefaults.setDefaults \
  --customise TauAnalysis/MCEmbeddingTools/embeddingCustomizeAll \
  --no_exec -n -1






# STEP1 Standalone Better to use a GEN filter as step 0 before e.g. TauAnalysis/MCEmbeddingTools/test/working_configs/step0_cfg.py) ## TODO add a cmsDriver command for step0
cmsDriver.py step1 \
  --filein dbs:/DYJetsToLL_M-50_13TeV-madgraph-pythia8-tauola_v2/Fall13-POSTLS162_V1-v2/GEN-SIM --fileout file:step1.root --python_filename step1.py  \
  --pileup Flat_20_50 --pileup_input dbs:/MinBias_TuneA2MB_13TeV-pythia8/Fall13-POSTLS162_V1-v1/GEN-SIM \
  --mc --eventcontent FEVTDEBUGHLT --datatier GEN-SIM-DIGI-RAW-HLTDEBUG \
  --conditions MCRUN2_74_V9A --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco --magField 38T_PostLS1  \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --no_exec -n 1000

## From here assume that the input file is produces by step0.py e.g. TauAnalysis/MCEmbeddingTools/test/working_configs/step0_cfg.py
# STEP1: mixing with pileup flat
cmsDriver.py step1 \
  --filein file:step0.root  --fileout file:step1.root --python_filename step1_cfg_flatPU.py  \
  --pileup Flat_20_50 --pileup_input dbs:/MinBias_TuneA2MB_13TeV-pythia8/Fall13-POSTLS162_V1-v1/GEN-SIM \
  --mc --eventcontent FEVTDEBUGHLT --datatier GEN-SIM-DIGI-RAW-HLTDEBUG \
  --conditions MCRUN2_74_V9A --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco --magField 38T_PostLS1  \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --no_exec -n -1

# STEP1: mixing with pileup standard 
cmsDriver.py step1 \
  --filein file:step0.root  --fileout file:step1.root --python_filename step1_cfg_25nsPU.py  \
  --pileup 2015_25ns_Startup_PoissonOOTPU --pileup_input dbs:/MinBias_TuneCUETP8M1_13TeV-pythia8/RunIIWinter15GS-MCRUN2_71_V1-v1/GEN-SIM \ 
  --mc --eventcontent FEVTDEBUGHLT --datatier GEN-SIM-DIGI-RAW-HLTDEBUG \
  --conditions MCRUN2_74_V9A --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco --magField 38T_PostLS1  \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \ 
  --no_exec -n -1


# STEP1: without pileup 
cmsDriver.py step1 \
  --filein file:step0.root  --fileout file:step1.root --python_filename step1_cfg_noPU.py  \
  --mc --eventcontent FEVTDEBUGHLT --datatier GEN-SIM-DIGI-RAW-HLTDEBUG \
  --conditions MCRUN2_74_V9A --step DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco --magField 38T_PostLS1  \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --no_exec -n -1


# STEP 2: reco
cmsDriver.py step2 \
  --filein file:step1.root \
  --fileout file:step2.root --python_filename step2_cfg.py \
  --mc --eventcontent RECOSIM --datatier GEN-SIM-RECO \
  --conditions MCRUN2_74_V9A --step RAW2DIGI,L1Reco,RECO --magField 38T_PostLS1 \ 
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --no_exec -n -1


# STEP 3: skimming
# Allow 1 second per event (note, only expect ~8% of input events to pass this stage)
cmsDriver.py TauAnalysis/MCEmbeddingTools/python/ZmumuStandaloneSelection_cff \
  --filein=file:step2.root \
  --fileout=skimmed.root --python_filename=skim.py \
  --eventcontent=RECOSIM \
  --conditions MCRUN2_74_V9A --step NONE --magField 38T_PostLS1 \
  --customise TauAnalysis/MCEmbeddingTools/setDefaults.setDefaults \
  --customise TauAnalysis/MCEmbeddingTools/ZmumuStandaloneSelectionAll \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring \
  --no_exec -n -1



# STEP 4: embedding
# Warning: must change inputProcessSIM to "SIM" in TauAnalysis/MCEmbeddingTools/python/setDefaults.py 
# Warning: must comment out 'drop *_genParticles_*_*' in the input module
cmsDriver.py TauAnalysis/MCEmbeddingTools/python/PFEmbeddingSource_cff \
  --filein=file:skimmed.root \
  --fileout=embedded.root --python_filename=embed.py \
  --conditions MCRUN2_74_V9A --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:@frozen25ns,RAW2DIGI,L1Reco,RECO,EI --magField 38T_PostLS1 \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring  \
  --customise TauAnalysis/MCEmbeddingTools/setDefaults.setDefaults \
  --customise TauAnalysis/MCEmbeddingTools/embeddingCustomizeAll \
  --no_exec -n -1

# STEP 5: miniAOD
cmsDriver.py miniAODstep  \
  --filein=file:embedded.root \
  --fileout=embedded_miniaod.root --python_filename=miniaod.py \
  --conditions 74X_mcRun2_asymptotic_v2 --step PAT --magField 38T_PostLS1  --datatier MINIAODSIM --runUnscheduled \
  --customise SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1,Configuration/DataProcessing/Utils.addMonitoring  \
  --no_exec -n -1
